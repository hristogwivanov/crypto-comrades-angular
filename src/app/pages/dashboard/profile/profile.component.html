<div class="profile-container">
  <div class="profile-header">
    <h1>Profile Settings</h1>
    <p>Manage your personal information</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading profile...</p>
  </div>

  <!-- Messages -->
  <div *ngIf="updateMessage" class="alert alert-success" (click)="clearMessages()">
    <i class="fas fa-check-circle"></i>
    {{ updateMessage }}
    <button type="button" class="close-btn">&times;</button>
  </div>

  <div *ngIf="updateError" class="alert alert-error" (click)="clearMessages()">
    <i class="fas fa-exclamation-circle"></i>
    {{ updateError }}
    <button type="button" class="close-btn">&times;</button>
  </div>

  <!-- Profile Content -->
  <div *ngIf="!isLoading" class="profile-content">
    
    <!-- Profile Information Section -->
    <div class="profile-section">
      <div class="section-header">
        <h2><i class="fas fa-user"></i> Profile Information</h2>
        <p>Update your basic profile information</p>
      </div>
      
      <form [formGroup]="profileForm" (ngSubmit)="onUpdateProfile()" class="profile-form">
        <!-- Avatar Upload Section -->
        <div class="avatar-section">
          <div class="current-avatar">
            <img 
              [src]="getCurrentAvatarUrl()" 
              [alt]="userProfile?.username + ' avatar'"
              (error)="onAvatarImageError($event)"
              class="current-avatar-image">
          </div>
          <div class="avatar-controls">
            <h4>Profile Picture</h4>
            <p>Upload a new avatar or provide a URL</p>
            
            <!-- File Upload -->
            <div class="upload-area">
              <input 
                type="file" 
                id="avatarFile" 
                accept="image/*" 
                (change)="onFileSelected($event)"
                class="file-input"
                #fileInput>
              <label for="avatarFile" class="file-label">
                <i class="fas fa-cloud-upload-alt"></i>
                Choose Image
              </label>
              
              <!-- Preview and Upload Controls -->
              <div *ngIf="selectedFile || previewUrl" class="upload-preview">
                <img *ngIf="previewUrl" [src]="previewUrl" alt="Preview" class="preview-image">
                <div class="upload-actions">
                  <button 
                    type="button" 
                    class="btn btn-success btn-sm"
                    (click)="uploadAvatar()"
                    [disabled]="!selectedFile || isUploading">
                    <i *ngIf="isUploading" class="fas fa-spinner fa-spin"></i>
                    {{ isUploading ? 'Uploading...' : 'Upload' }}
                  </button>
                  <button 
                    type="button" 
                    class="btn btn-secondary btn-sm"
                    (click)="cancelUpload()"
                    [disabled]="isUploading">
                    Cancel
                  </button>
                </div>
              </div>
            </div>

            <!-- URL Input Alternative -->
            <div class="url-input-section">
              <label for="avatar">Or enter Avatar URL</label>
              <div class="input-group">
                <input 
                  type="url" 
                  id="avatar" 
                  formControlName="avatar" 
                  placeholder="https://example.com/avatar.jpg"
                  class="form-control">
                <button 
                  type="button" 
                  class="btn btn-danger btn-sm"
                  (click)="removeAvatar()"
                  [disabled]="!userProfile?.avatar || isUpdating"
                  *ngIf="userProfile?.avatar">
                  <i class="fas fa-trash"></i>
                  Remove
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label for="username">Username *</label>
            <input 
              type="text" 
              id="username" 
              formControlName="username" 
              class="form-control"
              [class.error]="profileForm.get('username')?.invalid && profileForm.get('username')?.touched">
            <div *ngIf="profileForm.get('username')?.invalid && profileForm.get('username')?.touched" class="error-message">
              Username is required (min 3 characters)
            </div>
          </div>

          <div class="form-group">
            <label for="email">Email</label>
            <input 
              type="email" 
              id="email" 
              formControlName="email" 
              class="form-control"
              [class.error]="profileForm.get('email')?.invalid && profileForm.get('email')?.touched">
            <div *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched" class="error-message">
              Valid email is required
            </div>
          </div>

          <div class="form-group">
            <label for="location">Location</label>
            <input 
              type="text" 
              id="location" 
              formControlName="location" 
              placeholder="City, Country"
              class="form-control">
          </div>

          <div class="form-group full-width">
            <label for="bio">Bio</label>
            <textarea 
              id="bio" 
              formControlName="bio" 
              rows="4" 
              placeholder="Tell us about yourself..."
              class="form-control"></textarea>
          </div>
        </div>

        <div class="form-actions">
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="profileForm.invalid || isUpdating">
            <i *ngIf="isUpdating" class="fas fa-spinner fa-spin"></i>
            {{ isUpdating ? 'Updating...' : 'Update Profile' }}
          </button>
        </div>
      </form>
    </div>



  </div>
</div>
